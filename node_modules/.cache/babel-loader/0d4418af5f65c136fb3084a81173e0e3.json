{"ast":null,"code":"import _toConsumableArray from\"/Users/krithikasudupa/Documents/ipm-marketplace-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/krithikasudupa/Documents/ipm-marketplace-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/krithikasudupa/Documents/ipm-marketplace-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/krithikasudupa/Documents/ipm-marketplace-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/*\n#\n# Copyright 2020- IBM Inc. All rights reserved\n# SPDX-License-Identifier: Apache2.0\n#\n*/import React,{useState}from\"react\";import ContainerComponent from\"./../Layout/Container/ContainerComponent\";import axios from\"axios\";import{Table,TableHead,TableRow,TableHeader,TableBody,TableCell,Button,TableContainer,Loading,TextInput,Row,Column,DataTable,TableExpandHeader,TableExpandRow,TableExpandedRow,InlineNotification}from\"carbon-components-react\";import uuid from\"uuid/v4\";import\"./Subscriptions.css\";export default function SubscriptionsComponent(props){var subscriptions=props.subscriptions,setSubscriptions=props.setSubscriptions,rows=props.rows,setRows=props.setRows,timestamp=props.timestamp,setTimestamp=props.setTimestamp;var _useState=useState({status:false,message:\"\"}),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(\"ipm@mailinator.com\"),_useState4=_slicedToArray(_useState3,2),userId=_useState4[0],setUserId=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),spinner=_useState6[0],setSpinner=_useState6[1];React.useEffect(function(){var currentTimestamp=Date.now();var timeDiff=currentTimestamp-timestamp;if(timestamp===0){setTimestamp(currentTimestamp);}//if >= than five minutes do request\nif(timeDiff>=300000){console.log(\"timestamp expired\");setTimestamp(currentTimestamp);requestSubscriptions();}else{if(subscriptions.length){setSubscriptions(subscriptions);}if(rows.length){setRows(rows);}}},[]);var hostname=process.env.NODE_ENV===\"development\"?\"http://localhost:3000\":window.location.origin;var currentURL=window.location.href;var headers=[{key:\"name\",header:\"Name\"},{key:\"order-reference-number\",header:\"Order reference number\"}];var updateButtonProps=function updateButtonProps(id){return{size:\"small\",tooltipAlignment:\"center\",onClick:function onClick(){setError({status:false,message:\"\"});handleBuyMore(id);},className:\"buy-more-button\"};};var goButtonProps=function goButtonProps(){return{size:\"field\",tooltipAlignment:\"center\",onClick:function onClick(){return requestSubscriptions();},className:\"buy-more-button\"};};/**\n     * @param  {} planId\n     */var switchButtonProps=function switchButtonProps(id){return{onClick:function onClick(){return props.history.push(\"/partner/\".concat(id.split(\"/\")[2],\"/\").concat(id.split(\"/\")[0],\"/\").concat(id.split(\"/\")[1],\"/switch\"));},size:\"small\",tooltipAlignment:\"center\",className:\"purchase-button\"};};var emailInput=function emailInput(e){return setUserId(e.target.value);};/**\n     * @param  {} planId\n     */var handleBuyMore=function handleBuyMore(planId){var subscription=subscriptions.filter(function(data){return data.product.planId===planId;});sessionStorage.setItem(\"or\",subscription[0].order.orderReferenceNumber);if(subscription.length){axios.post(\"\".concat(hostname,\"/partner/product/\").concat(subscription[0].product.uuid,\"/buymore/\").concat(planId,\"/\").concat(subscription[0].order.orderReferenceNumber),{currentURL:currentURL}).then(function(response){if(response.status===200){window.open(response.data.redirectUrl);}}).catch(function(err){var _err$response,_err$response$data$er;setError({status:true,message:((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data$er=_err$response.data.err)===null||_err$response$data$er===void 0?void 0:_err$response$data$er.errorMessage)||\"Something went wrong!!!\"});});}};/**\n     * @param  {} uid\n     */var getPlanName=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(uid){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",axios.post(\"\".concat(hostname,\"/partner/product/\").concat(uid,\"/plans\")));case 1:case\"end\":return _context.stop();}}},_callee);}));return function getPlanName(_x){return _ref.apply(this,arguments);};}();/**\n     */var requestSubscriptions=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,subs,promiseKeys,promises,dataTableRows,groupedSubscriptions;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setSpinner(true);setRows([]);_context2.prev=2;_context2.next=5;return axios.get(\"\".concat(hostname,\"/partner/product/subscriptions/\").concat(userId));case 5:response=_context2.sent;if(response.status===200){if(response.data&&response.data.length){subs=response.data;promiseKeys=[];promises=[];dataTableRows=[];groupedSubscriptions=subs.reduce(function(acc,obj){var uuid=obj.product.uuid;if(!promiseKeys.includes(uuid)){promiseKeys.push(uuid);promises.push(getPlanName(uuid));}var key=obj.order.orderReferenceNumber;if(!acc[key]){acc[key]=[];}acc[key].push(obj);return acc;},{});Promise.all(promises).then(function(plans){plans=plans.map(function(planData){return planData.data;});var _loop=function _loop(k){var element=groupedSubscriptions[k];var rowName=plans.find(function(data){return data.id===element[0].product.uuid;});dataTableRows=[].concat(_toConsumableArray(dataTableRows),[{id:element[0].product.planId+\"/\"+k+\"/\"+element[0].product.uuid,name:rowName.name}]);};for(var k in groupedSubscriptions){_loop(k);}setRows(dataTableRows);});}setSpinner(false);setSubscriptions(response.data);setTimestamp(Date.now());}_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);console.log(_context2.t0);case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[2,9]]);}));return function requestSubscriptions(){return _ref2.apply(this,arguments);};}();var loadingProps=function loadingProps(){return{className:\"loading-spinner\",active:spinner,withOverlay:false,small:false,description:\"\"};};var notificationProps=function notificationProps(error){return{kind:\"error\",className:\"switch-error\",lowContrast:false,role:\"alert\",title:error.message,subtitle:\"Please try again or contact support if the error persists.\",iconDescription:\"describes the close button\",statusIconDescription:\"describes the status icon\",hideCloseButton:false,onCloseButtonClick:function onCloseButtonClick(){return _onCloseButtonClick();}};};var _onCloseButtonClick=function _onCloseButtonClick(){return setError({status:false,message:\"\"});};return/*#__PURE__*/React.createElement(ContainerComponent,null,error.status&&/*#__PURE__*/React.createElement(InlineNotification,notificationProps(error)),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Column,null,/*#__PURE__*/React.createElement(TextInput,{id:\"text\",value:userId?userId:\"\",onChange:function onChange(e){return emailInput(e);}})),/*#__PURE__*/React.createElement(Column,null,/*#__PURE__*/React.createElement(Button,goButtonProps(),\"Go\"))),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(DataTable,{rows:rows,headers:headers,render:function render(_ref3){var rows=_ref3.rows,headers=_ref3.headers,getHeaderProps=_ref3.getHeaderProps,getExpandHeaderProps=_ref3.getExpandHeaderProps,getRowProps=_ref3.getRowProps,getTableProps=_ref3.getTableProps,getTableContainerProps=_ref3.getTableContainerProps;return/*#__PURE__*/React.createElement(TableContainer,Object.assign({title:\"Subscriptions\",description:\"\"},getTableContainerProps()),/*#__PURE__*/React.createElement(Table,getTableProps(),/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableExpandHeader,Object.assign({enableExpando:true},getExpandHeaderProps())),headers.map(function(header,i){return/*#__PURE__*/React.createElement(TableHeader,Object.assign({key:i},getHeaderProps({header:header})),header.header);}))),/*#__PURE__*/React.createElement(TableBody,null,rows.map(function(row){return/*#__PURE__*/React.createElement(React.Fragment,{key:row.id},/*#__PURE__*/React.createElement(TableExpandRow,getRowProps({row:row}),/*#__PURE__*/React.createElement(TableCell,null,row.cells[0].value),/*#__PURE__*/React.createElement(TableCell,{key:uuid()},/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Column,{sm:12,md:12,lg:7},row.id.split(\"/\")[1]),/*#__PURE__*/React.createElement(Column,{sm:12,md:12,lg:3},/*#__PURE__*/React.createElement(Button,switchButtonProps(row.id),\"Switch Plan\")),/*#__PURE__*/React.createElement(Column,{sm:12,md:12,lg:2},/*#__PURE__*/React.createElement(Button,updateButtonProps(row.id.split(\"/\")[0]),\"Update\"))))),/*#__PURE__*/React.createElement(TableExpandedRow,{colSpan:headers.length+1,className:\"demo-expanded-td\"},/*#__PURE__*/React.createElement(Row,{key:uuid()},/*#__PURE__*/React.createElement(Column,null,/*#__PURE__*/React.createElement(\"h6\",null,\"Name\")),/*#__PURE__*/React.createElement(Column,null,/*#__PURE__*/React.createElement(\"h6\",null,\"State\")),/*#__PURE__*/React.createElement(Column,null,/*#__PURE__*/React.createElement(\"h6\",null,\"Quantity\"))),subscriptions.filter(function(data){return data.order.orderReferenceNumber===row.id.split(\"/\")[1];}).map(function(plan){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Row,{style:{padding:\"10px\"},key:uuid()},/*#__PURE__*/React.createElement(Column,null,/*#__PURE__*/React.createElement(\"h6\",null,plan.name)),/*#__PURE__*/React.createElement(Column,null,/*#__PURE__*/React.createElement(\"div\",null,plan.state)),/*#__PURE__*/React.createElement(Column,null,/*#__PURE__*/React.createElement(\"div\",null,plan.quantity))));})));}))));}}),spinner&&/*#__PURE__*/React.createElement(Loading,loadingProps()));}","map":{"version":3,"sources":["/Users/krithikasudupa/Documents/ipm-marketplace-app/src/components/Subscriptions/SubscriptionsComponent.js"],"names":["React","useState","ContainerComponent","axios","Table","TableHead","TableRow","TableHeader","TableBody","TableCell","Button","TableContainer","Loading","TextInput","Row","Column","DataTable","TableExpandHeader","TableExpandRow","TableExpandedRow","InlineNotification","uuid","SubscriptionsComponent","props","subscriptions","setSubscriptions","rows","setRows","timestamp","setTimestamp","status","message","error","setError","userId","setUserId","spinner","setSpinner","useEffect","currentTimestamp","Date","now","timeDiff","console","log","requestSubscriptions","length","hostname","process","env","NODE_ENV","window","location","origin","currentURL","href","headers","key","header","updateButtonProps","id","size","tooltipAlignment","onClick","handleBuyMore","className","goButtonProps","switchButtonProps","history","push","split","emailInput","e","target","value","planId","subscription","filter","data","product","sessionStorage","setItem","order","orderReferenceNumber","post","then","response","open","redirectUrl","catch","err","errorMessage","getPlanName","uid","get","subs","promiseKeys","promises","dataTableRows","groupedSubscriptions","reduce","acc","obj","includes","Promise","all","plans","map","planData","k","element","rowName","find","name","loadingProps","active","withOverlay","small","description","notificationProps","kind","lowContrast","role","title","subtitle","iconDescription","statusIconDescription","hideCloseButton","onCloseButtonClick","getHeaderProps","getExpandHeaderProps","getRowProps","getTableProps","getTableContainerProps","i","row","cells","plan","padding","state","quantity"],"mappings":"6qBAAA;AACA;AACA;AACA;AACA;AACA,EACA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,MAAOC,CAAAA,kBAAP,KAA+B,0CAA/B,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OACIC,KADJ,CAEIC,SAFJ,CAGIC,QAHJ,CAIIC,WAJJ,CAKIC,SALJ,CAMIC,SANJ,CAOIC,MAPJ,CAQIC,cARJ,CASIC,OATJ,CAUIC,SAVJ,CAWIC,GAXJ,CAYIC,MAZJ,CAaIC,SAbJ,CAcIC,iBAdJ,CAeIC,cAfJ,CAgBIC,gBAhBJ,CAiBIC,kBAjBJ,KAkBO,yBAlBP,CAmBA,MAAOC,CAAAA,IAAP,KAAiB,SAAjB,CACA,MAAO,qBAAP,CAEA,cAAe,SAASC,CAAAA,sBAAT,CAAgCC,KAAhC,CAAuC,CAClD,GACIC,CAAAA,aADJ,CAOID,KAPJ,CACIC,aADJ,CAEIC,gBAFJ,CAOIF,KAPJ,CAEIE,gBAFJ,CAGIC,IAHJ,CAOIH,KAPJ,CAGIG,IAHJ,CAIIC,OAJJ,CAOIJ,KAPJ,CAIII,OAJJ,CAKIC,SALJ,CAOIL,KAPJ,CAKIK,SALJ,CAMIC,YANJ,CAOIN,KAPJ,CAMIM,YANJ,CASA,cAA0B5B,QAAQ,CAAC,CAAE6B,MAAM,CAAE,KAAV,CAAiBC,OAAO,CAAE,EAA1B,CAAD,CAAlC,wCAAOC,KAAP,eAAcC,QAAd,eACA,eAA4BhC,QAAQ,CAAC,oBAAD,CAApC,yCAAOiC,MAAP,eAAeC,SAAf,eACA,eAA8BlC,QAAQ,CAAC,KAAD,CAAtC,yCAAOmC,OAAP,eAAgBC,UAAhB,eAEArC,KAAK,CAACsC,SAAN,CAAgB,UAAM,CAClB,GAAMC,CAAAA,gBAAgB,CAAGC,IAAI,CAACC,GAAL,EAAzB,CACA,GAAMC,CAAAA,QAAQ,CAAGH,gBAAgB,CAAGX,SAApC,CAEA,GAAIA,SAAS,GAAK,CAAlB,CAAqB,CACjBC,YAAY,CAACU,gBAAD,CAAZ,CACH,CAED;AACA,GAAIG,QAAQ,EAAI,MAAhB,CAAwB,CACpBC,OAAO,CAACC,GAAR,CAAY,mBAAZ,EACAf,YAAY,CAACU,gBAAD,CAAZ,CACAM,oBAAoB,GACvB,CAJD,IAIO,CACH,GAAIrB,aAAa,CAACsB,MAAlB,CAA0B,CACtBrB,gBAAgB,CAACD,aAAD,CAAhB,CACH,CACD,GAAIE,IAAI,CAACoB,MAAT,CAAiB,CACbnB,OAAO,CAACD,IAAD,CAAP,CACH,CACJ,CACJ,CArBD,CAqBG,EArBH,EAuBA,GAAMqB,CAAAA,QAAQ,CACVC,OAAO,CAACC,GAAR,CAAYC,QAAZ,GAAyB,aAAzB,CACM,uBADN,CAEMC,MAAM,CAACC,QAAP,CAAgBC,MAH1B,CAIA,GAAMC,CAAAA,UAAU,CAAGH,MAAM,CAACC,QAAP,CAAgBG,IAAnC,CAEA,GAAMC,CAAAA,OAAO,CAAG,CACZ,CACIC,GAAG,CAAE,MADT,CAEIC,MAAM,CAAE,MAFZ,CADY,CAKZ,CACID,GAAG,CAAE,wBADT,CAEIC,MAAM,CAAE,wBAFZ,CALY,CAAhB,CAWA,GAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,EAAD,CAAQ,CAC9B,MAAO,CACHC,IAAI,CAAE,OADH,CAEHC,gBAAgB,CAAE,QAFf,CAGHC,OAAO,CAAE,kBAAM,CACX9B,QAAQ,CAAC,CAAEH,MAAM,CAAE,KAAV,CAAiBC,OAAO,CAAE,EAA1B,CAAD,CAAR,CACAiC,aAAa,CAACJ,EAAD,CAAb,CACH,CANE,CAOHK,SAAS,CAAE,iBAPR,CAAP,CASH,CAVD,CAYA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CACxB,MAAO,CACHL,IAAI,CAAE,OADH,CAEHC,gBAAgB,CAAE,QAFf,CAGHC,OAAO,CAAE,yBAAMlB,CAAAA,oBAAoB,EAA1B,EAHN,CAIHoB,SAAS,CAAE,iBAJR,CAAP,CAMH,CAPD,CASA;AACJ;AACA,OACI,GAAME,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACP,EAAD,CAAQ,CAC9B,MAAO,CACHG,OAAO,CAAE,yBACLxC,CAAAA,KAAK,CAAC6C,OAAN,CAAcC,IAAd,oBACgBT,EAAE,CAACU,KAAH,CAAS,GAAT,EAAc,CAAd,CADhB,aACoCV,EAAE,CAACU,KAAH,CAAS,GAAT,EAAc,CAAd,CADpC,aAEQV,EAAE,CAACU,KAAH,CAAS,GAAT,EAAc,CAAd,CAFR,YADK,EADN,CAOHT,IAAI,CAAE,OAPH,CAQHC,gBAAgB,CAAE,QARf,CAUHG,SAAS,CAAE,iBAVR,CAAP,CAYH,CAbD,CAeA,GAAMM,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACC,CAAD,QAAOrC,CAAAA,SAAS,CAACqC,CAAC,CAACC,MAAF,CAASC,KAAV,CAAhB,EAAnB,CAEA;AACJ;AACA,OACI,GAAMV,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACW,MAAD,CAAY,CAC9B,GAAMC,CAAAA,YAAY,CAAGpD,aAAa,CAACqD,MAAd,CACjB,SAACC,IAAD,QAAUA,CAAAA,IAAI,CAACC,OAAL,CAAaJ,MAAb,GAAwBA,MAAlC,EADiB,CAArB,CAIAK,cAAc,CAACC,OAAf,CACI,IADJ,CAEIL,YAAY,CAAC,CAAD,CAAZ,CAAgBM,KAAhB,CAAsBC,oBAF1B,EAKA,GAAIP,YAAY,CAAC9B,MAAjB,CAAyB,CACrB3C,KAAK,CACAiF,IADL,WAEWrC,QAFX,6BAEuC6B,YAAY,CAAC,CAAD,CAAZ,CAAgBG,OAAhB,CAAwB1D,IAF/D,qBAE+EsD,MAF/E,aAEyFC,YAAY,CAAC,CAAD,CAAZ,CAAgBM,KAAhB,CAAsBC,oBAF/G,EAGQ,CAAE7B,UAAU,CAAVA,UAAF,CAHR,EAKK+B,IALL,CAKU,SAACC,QAAD,CAAc,CAChB,GAAIA,QAAQ,CAACxD,MAAT,GAAoB,GAAxB,CAA6B,CACzBqB,MAAM,CAACoC,IAAP,CAAYD,QAAQ,CAACR,IAAT,CAAcU,WAA1B,EACH,CACJ,CATL,EAUKC,KAVL,CAUW,SAACC,GAAD,CAAS,yCACZzD,QAAQ,CAAC,CACLH,MAAM,CAAE,IADH,CAELC,OAAO,CACH,gBAAA2D,GAAG,CAACJ,QAAJ,6EAAcR,IAAd,CAAmBY,GAAnB,sEAAwBC,YAAxB,GACA,yBAJC,CAAD,CAAR,CAMH,CAjBL,EAkBH,CACJ,CA9BD,CAgCA;AACJ;AACA,OACI,GAAMC,CAAAA,WAAW,0FAAG,iBAAOC,GAAP,kJACT1F,KAAK,CAACiF,IAAN,WAAcrC,QAAd,6BAA0C8C,GAA1C,WADS,wDAAH,kBAAXD,CAAAA,WAAW,4CAAjB,CAIA;AACJ,OACI,GAAM/C,CAAAA,oBAAoB,2FAAG,kNACzBR,UAAU,CAAC,IAAD,CAAV,CACAV,OAAO,CAAC,EAAD,CAAP,CAFyB,wCAKExB,CAAAA,KAAK,CAAC2F,GAAN,WAChB/C,QADgB,2CAC0Bb,MAD1B,EALF,QAKfoD,QALe,gBASrB,GAAIA,QAAQ,CAACxD,MAAT,GAAoB,GAAxB,CAA6B,CACzB,GAAIwD,QAAQ,CAACR,IAAT,EAAiBQ,QAAQ,CAACR,IAAT,CAAchC,MAAnC,CAA2C,CACjCiD,IADiC,CAC1BT,QAAQ,CAACR,IADiB,CAGjCkB,WAHiC,CAGnB,EAHmB,CAIjCC,QAJiC,CAItB,EAJsB,CAKnCC,aALmC,CAKnB,EALmB,CAOjCC,oBAPiC,CAOVJ,IAAI,CAACK,MAAL,CAAY,SACrCC,GADqC,CAErCC,GAFqC,CAGvC,CACE,GAAMjF,CAAAA,IAAI,CAAGiF,GAAG,CAACvB,OAAJ,CAAY1D,IAAzB,CAEA,GAAI,CAAC2E,WAAW,CAACO,QAAZ,CAAqBlF,IAArB,CAAL,CAAiC,CAC7B2E,WAAW,CAAC3B,IAAZ,CAAiBhD,IAAjB,EACA4E,QAAQ,CAAC5B,IAAT,CAAcuB,WAAW,CAACvE,IAAD,CAAzB,EACH,CAED,GAAMoC,CAAAA,GAAG,CAAG6C,GAAG,CAACpB,KAAJ,CAAUC,oBAAtB,CAEA,GAAI,CAACkB,GAAG,CAAC5C,GAAD,CAAR,CAAe,CACX4C,GAAG,CAAC5C,GAAD,CAAH,CAAW,EAAX,CACH,CACD4C,GAAG,CAAC5C,GAAD,CAAH,CAASY,IAAT,CAAciC,GAAd,EAEA,MAAOD,CAAAA,GAAP,CACH,CAnB4B,CAoB7B,EApB6B,CAPU,CA6BvCG,OAAO,CAACC,GAAR,CAAYR,QAAZ,EAAsBZ,IAAtB,CAA2B,SAACqB,KAAD,CAAW,CAClCA,KAAK,CAAGA,KAAK,CAACC,GAAN,CAAU,SAACC,QAAD,QAAcA,CAAAA,QAAQ,CAAC9B,IAAvB,EAAV,CAAR,CADkC,yBAGzB+B,CAHyB,EAI9B,GAAMC,CAAAA,OAAO,CAAGX,oBAAoB,CAACU,CAAD,CAApC,CACA,GAAME,CAAAA,OAAO,CAAGL,KAAK,CAACM,IAAN,CACZ,SAAClC,IAAD,QAAUA,CAAAA,IAAI,CAAClB,EAAL,GAAYkD,OAAO,CAAC,CAAD,CAAP,CAAW/B,OAAX,CAAmB1D,IAAzC,EADY,CAAhB,CAIA6E,aAAa,8BACNA,aADM,GAET,CACItC,EAAE,CACEkD,OAAO,CAAC,CAAD,CAAP,CAAW/B,OAAX,CAAmBJ,MAAnB,CACA,GADA,CAEAkC,CAFA,CAGA,GAHA,CAIAC,OAAO,CAAC,CAAD,CAAP,CAAW/B,OAAX,CAAmB1D,IAN3B,CAOI4F,IAAI,CAAEF,OAAO,CAACE,IAPlB,CAFS,EAAb,CAT8B,EAGlC,IAAK,GAAIJ,CAAAA,CAAT,GAAcV,CAAAA,oBAAd,CAAoC,OAA3BU,CAA2B,EAkBnC,CACDlF,OAAO,CAACuE,aAAD,CAAP,CACH,CAvBD,EAwBH,CAED7D,UAAU,CAAC,KAAD,CAAV,CACAZ,gBAAgB,CAAC6D,QAAQ,CAACR,IAAV,CAAhB,CACAjD,YAAY,CAACW,IAAI,CAACC,GAAL,EAAD,CAAZ,CACH,CApEoB,mFAsErBE,OAAO,CAACC,GAAR,eAtEqB,sEAAH,kBAApBC,CAAAA,oBAAoB,2CAA1B,CA0EA,GAAMqE,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,SAAO,CACxBjD,SAAS,CAAE,iBADa,CAExBkD,MAAM,CAAE/E,OAFgB,CAGxBgF,WAAW,CAAE,KAHW,CAIxBC,KAAK,CAAE,KAJiB,CAKxBC,WAAW,CAAE,EALW,CAAP,EAArB,CAQA,GAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACvF,KAAD,QAAY,CAClCwF,IAAI,CAAE,OAD4B,CAElCvD,SAAS,CAAE,cAFuB,CAGlCwD,WAAW,CAAE,KAHqB,CAIlCC,IAAI,CAAE,OAJ4B,CAKlCC,KAAK,CAAE3F,KAAK,CAACD,OALqB,CAMlC6F,QAAQ,CAAE,4DANwB,CAOlCC,eAAe,CAAE,4BAPiB,CAQlCC,qBAAqB,CAAE,2BARW,CASlCC,eAAe,CAAE,KATiB,CAUlCC,kBAAkB,CAAE,oCAAMA,CAAAA,mBAAkB,EAAxB,EAVc,CAAZ,EAA1B,CAaA,GAAMA,CAAAA,mBAAkB,CAAG,QAArBA,CAAAA,mBAAqB,SAAM/F,CAAAA,QAAQ,CAAC,CAAEH,MAAM,CAAE,KAAV,CAAiBC,OAAO,CAAE,EAA1B,CAAD,CAAd,EAA3B,CAEA,mBACI,oBAAC,kBAAD,MACKC,KAAK,CAACF,MAAN,eACG,oBAAC,kBAAD,CAAwByF,iBAAiB,CAACvF,KAAD,CAAzC,CAFR,cAII,8BAJJ,cAKI,oBAAC,GAAD,mBACI,oBAAC,MAAD,mBACI,oBAAC,SAAD,EACI,EAAE,CAAC,MADP,CAEI,KAAK,CAAEE,MAAM,CAAGA,MAAH,CAAY,EAF7B,CAGI,QAAQ,CAAE,kBAACsC,CAAD,QAAOD,CAAAA,UAAU,CAACC,CAAD,CAAjB,EAHd,EADJ,CADJ,cAQI,oBAAC,MAAD,mBACI,oBAAC,MAAD,CAAYN,aAAa,EAAzB,MADJ,CARJ,CALJ,cAiBI,8BAjBJ,cAmBI,oBAAC,SAAD,EACI,IAAI,CAAExC,IADV,CAEI,OAAO,CAAE8B,OAFb,CAGI,MAAM,CAAE,0BACJ9B,CAAAA,IADI,OACJA,IADI,CAEJ8B,OAFI,OAEJA,OAFI,CAGJyE,cAHI,OAGJA,cAHI,CAIJC,oBAJI,OAIJA,oBAJI,CAKJC,WALI,OAKJA,WALI,CAMJC,aANI,OAMJA,aANI,CAOJC,sBAPI,OAOJA,sBAPI,oBASJ,oBAAC,cAAD,gBACI,KAAK,CAAC,eADV,CAEI,WAAW,CAAC,EAFhB,EAGQA,sBAAsB,EAH9B,eAKI,oBAAC,KAAD,CAAWD,aAAa,EAAxB,cACI,oBAAC,SAAD,mBACI,oBAAC,QAAD,mBACI,oBAAC,iBAAD,gBACI,aAAa,CAAE,IADnB,EAEQF,oBAAoB,EAF5B,EADJ,CAKK1E,OAAO,CAACmD,GAAR,CAAY,SAACjD,MAAD,CAAS4E,CAAT,qBACT,oBAAC,WAAD,gBACI,GAAG,CAAEA,CADT,EAEQL,cAAc,CAAC,CAAEvE,MAAM,CAANA,MAAF,CAAD,CAFtB,EAIKA,MAAM,CAACA,MAJZ,CADS,EAAZ,CALL,CADJ,CADJ,cAiBI,oBAAC,SAAD,MACKhC,IAAI,CAACiF,GAAL,CAAS,SAAC4B,GAAD,qBACN,oBAAC,KAAD,CAAO,QAAP,EAAgB,GAAG,CAAEA,GAAG,CAAC3E,EAAzB,eACI,oBAAC,cAAD,CACQuE,WAAW,CAAC,CAAEI,GAAG,CAAHA,GAAF,CAAD,CADnB,cAGI,oBAAC,SAAD,MACKA,GAAG,CAACC,KAAJ,CAAU,CAAV,EAAa9D,KADlB,CAHJ,cAOI,oBAAC,SAAD,EAAW,GAAG,CAAErD,IAAI,EAApB,eACI,oBAAC,GAAD,mBACI,oBAAC,MAAD,EACI,EAAE,CAAE,EADR,CAEI,EAAE,CAAE,EAFR,CAGI,EAAE,CAAE,CAHR,EAKKkH,GAAG,CAAC3E,EAAJ,CAAOU,KAAP,CAAa,GAAb,EAAkB,CAAlB,CALL,CADJ,cAQI,oBAAC,MAAD,EACI,EAAE,CAAE,EADR,CAEI,EAAE,CAAE,EAFR,CAGI,EAAE,CAAE,CAHR,eAKI,oBAAC,MAAD,CACQH,iBAAiB,CACjBoE,GAAG,CAAC3E,EADa,CADzB,eALJ,CARJ,cAqBI,oBAAC,MAAD,EACI,EAAE,CAAE,EADR,CAEI,EAAE,CAAE,EAFR,CAGI,EAAE,CAAE,CAHR,eAKI,oBAAC,MAAD,CACQD,iBAAiB,CACjB4E,GAAG,CAAC3E,EAAJ,CAAOU,KAAP,CACI,GADJ,EAEE,CAFF,CADiB,CADzB,UALJ,CArBJ,CADJ,CAPJ,CADJ,cAgDI,oBAAC,gBAAD,EACI,OAAO,CAAEd,OAAO,CAACV,MAAR,CAAiB,CAD9B,CAEI,SAAS,CAAC,kBAFd,eAII,oBAAC,GAAD,EAAK,GAAG,CAAEzB,IAAI,EAAd,eACI,oBAAC,MAAD,mBACI,qCADJ,CADJ,cAII,oBAAC,MAAD,mBACI,sCADJ,CAJJ,cAOI,oBAAC,MAAD,mBACI,yCADJ,CAPJ,CAJJ,CAeKG,aAAa,CACTqD,MADJ,CAEO,SAACC,IAAD,QACIA,CAAAA,IAAI,CAACI,KAAL,CACKC,oBADL,GAEAoD,GAAG,CAAC3E,EAAJ,CAAOU,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAHJ,EAFP,EAOIqC,GAPJ,CAOQ,SAAC8B,IAAD,qBACD,qDACI,oBAAC,GAAD,EACI,KAAK,CAAE,CACHC,OAAO,CAAE,MADN,CADX,CAII,GAAG,CAAErH,IAAI,EAJb,eAMI,oBAAC,MAAD,mBACI,8BACKoH,IAAI,CAACxB,IADV,CADJ,CANJ,cAWI,oBAAC,MAAD,mBACI,+BACKwB,IAAI,CAACE,KADV,CADJ,CAXJ,cAgBI,oBAAC,MAAD,mBACI,+BAEQF,IAAI,CAACG,QAFb,CADJ,CAhBJ,CADJ,CADC,EAPR,CAfL,CAhDJ,CADM,EAAT,CADL,CAjBJ,CALJ,CATI,EAHZ,EAnBJ,CAkKKxG,OAAO,eAAI,oBAAC,OAAD,CAAa8E,YAAY,EAAzB,CAlKhB,CADJ,CAsKH","sourcesContent":["/*\n#\n# Copyright 2020- IBM Inc. All rights reserved\n# SPDX-License-Identifier: Apache2.0\n#\n*/\nimport React, { useState } from \"react\";\nimport ContainerComponent from \"./../Layout/Container/ContainerComponent\";\nimport axios from \"axios\";\nimport {\n    Table,\n    TableHead,\n    TableRow,\n    TableHeader,\n    TableBody,\n    TableCell,\n    Button,\n    TableContainer,\n    Loading,\n    TextInput,\n    Row,\n    Column,\n    DataTable,\n    TableExpandHeader,\n    TableExpandRow,\n    TableExpandedRow,\n    InlineNotification,\n} from \"carbon-components-react\";\nimport uuid from \"uuid/v4\";\nimport \"./Subscriptions.css\";\n\nexport default function SubscriptionsComponent(props) {\n    const {\n        subscriptions,\n        setSubscriptions,\n        rows,\n        setRows,\n        timestamp,\n        setTimestamp,\n    } = props;\n\n    const [error, setError] = useState({ status: false, message: \"\" });\n    const [userId, setUserId] = useState(\"ipm@mailinator.com\");\n    const [spinner, setSpinner] = useState(false);\n\n    React.useEffect(() => {\n        const currentTimestamp = Date.now();\n        const timeDiff = currentTimestamp - timestamp;\n\n        if (timestamp === 0) {\n            setTimestamp(currentTimestamp);\n        }\n\n        //if >= than five minutes do request\n        if (timeDiff >= 300000) {\n            console.log(\"timestamp expired\");\n            setTimestamp(currentTimestamp);\n            requestSubscriptions();\n        } else {\n            if (subscriptions.length) {\n                setSubscriptions(subscriptions);\n            }\n            if (rows.length) {\n                setRows(rows);\n            }\n        }\n    }, []);\n\n    const hostname =\n        process.env.NODE_ENV === \"development\"\n            ? \"http://localhost:3000\"\n            : window.location.origin;\n    const currentURL = window.location.href;\n\n    const headers = [\n        {\n            key: \"name\",\n            header: \"Name\",\n        },\n        {\n            key: \"order-reference-number\",\n            header: \"Order reference number\",\n        },\n    ];\n\n    const updateButtonProps = (id) => {\n        return {\n            size: \"small\",\n            tooltipAlignment: \"center\",\n            onClick: () => {\n                setError({ status: false, message: \"\" });\n                handleBuyMore(id);\n            },\n            className: \"buy-more-button\",\n        };\n    };\n\n    const goButtonProps = () => {\n        return {\n            size: \"field\",\n            tooltipAlignment: \"center\",\n            onClick: () => requestSubscriptions(),\n            className: \"buy-more-button\",\n        };\n    };\n\n    /**\n     * @param  {} planId\n     */\n    const switchButtonProps = (id) => {\n        return {\n            onClick: () =>\n                props.history.push(\n                    `/partner/${id.split(\"/\")[2]}/${id.split(\"/\")[0]}/${\n                        id.split(\"/\")[1]\n                    }/switch`\n                ),\n            size: \"small\",\n            tooltipAlignment: \"center\",\n\n            className: \"purchase-button\",\n        };\n    };\n\n    const emailInput = (e) => setUserId(e.target.value);\n\n    /**\n     * @param  {} planId\n     */\n    const handleBuyMore = (planId) => {\n        const subscription = subscriptions.filter(\n            (data) => data.product.planId === planId\n        );\n\n        sessionStorage.setItem(\n            \"or\",\n            subscription[0].order.orderReferenceNumber\n        );\n\n        if (subscription.length) {\n            axios\n                .post(\n                    `${hostname}/partner/product/${subscription[0].product.uuid}/buymore/${planId}/${subscription[0].order.orderReferenceNumber}`,\n                    { currentURL }\n                )\n                .then((response) => {\n                    if (response.status === 200) {\n                        window.open(response.data.redirectUrl);\n                    }\n                })\n                .catch((err) => {\n                    setError({\n                        status: true,\n                        message:\n                            err.response?.data.err?.errorMessage ||\n                            \"Something went wrong!!!\",\n                    });\n                });\n        }\n    };\n\n    /**\n     * @param  {} uid\n     */\n    const getPlanName = async (uid) => {\n        return axios.post(`${hostname}/partner/product/${uid}/plans`);\n    };\n\n    /**\n     */\n    const requestSubscriptions = async () => {\n        setSpinner(true);\n        setRows([]);\n\n        try {\n            const response = await axios.get(\n                `${hostname}/partner/product/subscriptions/${userId}`\n            );\n\n            if (response.status === 200) {\n                if (response.data && response.data.length) {\n                    const subs = response.data;\n\n                    const promiseKeys = [];\n                    const promises = [];\n                    let dataTableRows = [];\n\n                    const groupedSubscriptions = subs.reduce(function (\n                        acc,\n                        obj\n                    ) {\n                        const uuid = obj.product.uuid;\n\n                        if (!promiseKeys.includes(uuid)) {\n                            promiseKeys.push(uuid);\n                            promises.push(getPlanName(uuid));\n                        }\n\n                        const key = obj.order.orderReferenceNumber;\n\n                        if (!acc[key]) {\n                            acc[key] = [];\n                        }\n                        acc[key].push(obj);\n\n                        return acc;\n                    },\n                    {});\n\n                    Promise.all(promises).then((plans) => {\n                        plans = plans.map((planData) => planData.data);\n\n                        for (let k in groupedSubscriptions) {\n                            const element = groupedSubscriptions[k];\n                            const rowName = plans.find(\n                                (data) => data.id === element[0].product.uuid\n                            );\n\n                            dataTableRows = [\n                                ...dataTableRows,\n                                {\n                                    id:\n                                        element[0].product.planId +\n                                        \"/\" +\n                                        k +\n                                        \"/\" +\n                                        element[0].product.uuid,\n                                    name: rowName.name,\n                                },\n                            ];\n                        }\n                        setRows(dataTableRows);\n                    });\n                }\n\n                setSpinner(false);\n                setSubscriptions(response.data);\n                setTimestamp(Date.now());\n            }\n        } catch (err) {\n            console.log(err);\n        }\n    };\n\n    const loadingProps = () => ({\n        className: \"loading-spinner\",\n        active: spinner,\n        withOverlay: false,\n        small: false,\n        description: \"\",\n    });\n\n    const notificationProps = (error) => ({\n        kind: \"error\",\n        className: \"switch-error\",\n        lowContrast: false,\n        role: \"alert\",\n        title: error.message,\n        subtitle: \"Please try again or contact support if the error persists.\",\n        iconDescription: \"describes the close button\",\n        statusIconDescription: \"describes the status icon\",\n        hideCloseButton: false,\n        onCloseButtonClick: () => onCloseButtonClick(),\n    });\n\n    const onCloseButtonClick = () => setError({ status: false, message: \"\" });\n\n    return (\n        <ContainerComponent>\n            {error.status && (\n                <InlineNotification {...notificationProps(error)} />\n            )}\n            <br />\n            <Row>\n                <Column>\n                    <TextInput\n                        id='text'\n                        value={userId ? userId : \"\"}\n                        onChange={(e) => emailInput(e)}\n                    ></TextInput>\n                </Column>\n                <Column>\n                    <Button {...goButtonProps()}>Go</Button>\n                </Column>\n            </Row>\n            <br />\n\n            <DataTable\n                rows={rows}\n                headers={headers}\n                render={({\n                    rows,\n                    headers,\n                    getHeaderProps,\n                    getExpandHeaderProps,\n                    getRowProps,\n                    getTableProps,\n                    getTableContainerProps,\n                }) => (\n                    <TableContainer\n                        title='Subscriptions'\n                        description=''\n                        {...getTableContainerProps()}\n                    >\n                        <Table {...getTableProps()}>\n                            <TableHead>\n                                <TableRow>\n                                    <TableExpandHeader\n                                        enableExpando={true}\n                                        {...getExpandHeaderProps()}\n                                    />\n                                    {headers.map((header, i) => (\n                                        <TableHeader\n                                            key={i}\n                                            {...getHeaderProps({ header })}\n                                        >\n                                            {header.header}\n                                        </TableHeader>\n                                    ))}\n                                </TableRow>\n                            </TableHead>\n                            <TableBody>\n                                {rows.map((row) => (\n                                    <React.Fragment key={row.id}>\n                                        <TableExpandRow\n                                            {...getRowProps({ row })}\n                                        >\n                                            <TableCell>\n                                                {row.cells[0].value}\n                                            </TableCell>\n\n                                            <TableCell key={uuid()}>\n                                                <Row>\n                                                    <Column\n                                                        sm={12}\n                                                        md={12}\n                                                        lg={7}\n                                                    >\n                                                        {row.id.split(\"/\")[1]}\n                                                    </Column>\n                                                    <Column\n                                                        sm={12}\n                                                        md={12}\n                                                        lg={3}\n                                                    >\n                                                        <Button\n                                                            {...switchButtonProps(\n                                                                row.id\n                                                            )}\n                                                        >\n                                                            Switch Plan\n                                                        </Button>\n                                                    </Column>\n                                                    <Column\n                                                        sm={12}\n                                                        md={12}\n                                                        lg={2}\n                                                    >\n                                                        <Button\n                                                            {...updateButtonProps(\n                                                                row.id.split(\n                                                                    \"/\"\n                                                                )[0]\n                                                            )}\n                                                        >\n                                                            Update\n                                                        </Button>\n                                                    </Column>\n                                                </Row>\n                                            </TableCell>\n                                        </TableExpandRow>\n                                        <TableExpandedRow\n                                            colSpan={headers.length + 1}\n                                            className='demo-expanded-td'\n                                        >\n                                            <Row key={uuid()}>\n                                                <Column>\n                                                    <h6>Name</h6>\n                                                </Column>\n                                                <Column>\n                                                    <h6>State</h6>\n                                                </Column>\n                                                <Column>\n                                                    <h6>Quantity</h6>\n                                                </Column>\n                                            </Row>\n                                            {subscriptions\n                                                .filter(\n                                                    (data) =>\n                                                        data.order\n                                                            .orderReferenceNumber ===\n                                                        row.id.split(\"/\")[1]\n                                                )\n                                                .map((plan) => (\n                                                    <>\n                                                        <Row\n                                                            style={{\n                                                                padding: \"10px\",\n                                                            }}\n                                                            key={uuid()}\n                                                        >\n                                                            <Column>\n                                                                <h6>\n                                                                    {plan.name}\n                                                                </h6>\n                                                            </Column>\n                                                            <Column>\n                                                                <div>\n                                                                    {plan.state}\n                                                                </div>\n                                                            </Column>\n                                                            <Column>\n                                                                <div>\n                                                                    {\n                                                                        plan.quantity\n                                                                    }\n                                                                </div>\n                                                            </Column>\n                                                        </Row>\n                                                    </>\n                                                ))}\n                                        </TableExpandedRow>\n                                    </React.Fragment>\n                                ))}\n                            </TableBody>\n                        </Table>\n                    </TableContainer>\n                )}\n            />\n\n            {spinner && <Loading {...loadingProps()} />}\n        </ContainerComponent>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}